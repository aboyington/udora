        <!-- FastClick -->
        <script src="<?php echo base_url('adminudora-assets/libraries/fastclick/lib/fastclick.js'); ?>"></script>
        <!-- NProgress -->
        <script src="<?php echo base_url('adminudora-assets/libraries/nprogress/nprogress.js'); ?>"></script>
        <!-- Chart.js -->
        <script src="<?php echo base_url('adminudora-assets/libraries/Chart.js/dist/Chart.min.js'); ?>"></script>
        <!-- gauge.js -->
        <script src="<?php echo base_url('adminudora-assets/libraries/gauge.js/dist/gauge.min.js'); ?>"></script>
        <!-- bootstrap-progressbar -->
        <script src="<?php echo base_url('adminudora-assets/libraries/bootstrap-progressbar/bootstrap-progressbar.min.js'); ?>"></script>
        <!-- iCheck -->
        <script src="<?php echo base_url('adminudora-assets/libraries/iCheck/icheck.min.js'); ?>"></script>
        <!-- Skycons -->
        <script src="<?php echo base_url('adminudora-assets/libraries/skycons/skycons.js'); ?>"></script>
        <!-- Flot -->
        <script src="<?php echo base_url('adminudora-assets/libraries/Flot/jquery.flot.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/Flot/jquery.flot.pie.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/Flot/jquery.flot.time.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/Flot/jquery.flot.stack.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/Flot/jquery.flot.resize.js'); ?>"></script>
        <!-- Flot plugins -->
        <script src="<?php echo base_url('adminudora-assets/libraries/flot.orderbars/js/jquery.flot.orderBars.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/flot-spline/js/jquery.flot.spline.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/flot.curvedlines/curvedLines.js'); ?>"></script>
        <!-- DateJS -->
        <script src="<?php echo base_url('adminudora-assets/libraries/DateJS/build/date.js'); ?>"></script>
        <!-- JQVMap -->
        <script src="<?php echo base_url('adminudora-assets/libraries/jqvmap/dist/jquery.vmap.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/jqvmap/dist/maps/jquery.vmap.world.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/jqvmap/examples/js/jquery.vmap.sampledata.js'); ?>"></script>
        <!-- bootstrap-daterangepicker -->
        <script src="<?php echo base_url('adminudora-assets/libraries/moment/min/moment.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/bootstrap-daterangepicker/daterangepicker.js'); ?>"></script>

        <!-- Datatables -->
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net/js/jquery.dataTables.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-bs/js/dataTables.bootstrap.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-buttons/js/dataTables.buttons.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-buttons-bs/js/buttons.bootstrap.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-buttons/js/buttons.flash.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-buttons/js/buttons.html5.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-buttons/js/buttons.print.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-keytable/js/dataTables.keyTable.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-responsive/js/dataTables.responsive.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-responsive-bs/js/responsive.bootstrap.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/datatables.net-scroller/js/dataTables.scroller.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/jszip/dist/jszip.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/pdfmake/build/pdfmake.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/pdfmake/build/vfs_fonts.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/validator/validator.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/raphael/raphael.min.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/libraries/morris.js/morris.min.js'); ?>"></script>
        <!-- bootstrap-daterangepicker -->
        <script src="<?php echo base_url('adminudora-assets/libraries//bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js'); ?>"></script>
        <!-- bootstrap-datetimepicker -->    
        
        
        <script src="<?php echo base_url('adminudora-assets/js/gmap3.min.js')?>"></script>
        
        <script src="<?php echo base_url('adminudora-assets/js/jquery-ui-1.10.3.custom.min.js')?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/blueimp-gallery.min.js')?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/load-image.js'); ?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/footable/js/footable.js')?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/jquery.mjs.nestedSortable.js');?>"></script>
        <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
        <script src="<?php echo base_url('adminudora-assets/js/fileupload/jquery.iframe-transport.js')?>"></script>
        <!-- The basic File Upload plugin -->
        <script src="<?php echo base_url('adminudora-assets/js/fileupload/jquery.fileupload.js')?>"></script>
        <!-- The File Upload file processing plugin -->
        <script src="<?php echo base_url('adminudora-assets/js/fileupload/jquery.fileupload-fp.js')?>"></script>
        <!-- The File Upload user interface plugin -->
        <script src="<?php echo base_url('adminudora-assets/js/fileupload/jquery.fileupload-ui.js')?>"></script>
        <!-- The XDomainRequest Transport is included for cross-domain file deletion for IE8+ -->
        <!--[if gte IE 8]><script src="adminudora-assets/js/cors/jquery.xdr-transport.js')?>"></script><![endif]-->

        <script src="<?php echo base_url('adminudora-assets/js/jquery.number.js')?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/jquery.h5validate.js')?>"></script>
        <script src="<?php echo base_url('adminudora-assets/js/jquery.helpers.js');?>"></script>
        
        <script src="<?php echo base_url('adminudora-assets/libraries/ckeditor/ckeditor.js')?>"></script>
        <script>
        CKEDITOR.config.forcePasteAsPlainText = false; // default so content won't be manipulated on load
        CKEDITOR.config.basicEntities = true;
        CKEDITOR.config.entities = true;
        CKEDITOR.config.entities_latin = false;
        CKEDITOR.config.entities_greek = false;
        CKEDITOR.config.entities_processNumerical = false;
        CKEDITOR.config.fillEmptyBlocks = function (element) {
                return true; // DON'T DO ANYTHING!!!!!
        }; 
        CKEDITOR.config.allowedContent = true; // don't filter my data 
        CKEDITOR.dtd.a.div = 1;
        CKEDITOR.dtd.a.p = 1;
        CKEDITOR.config.protectedSource.push(/<i[^>]*><\/i>/g);
        CKEDITOR.config.extraAllowedContent = 'p(*)[*]{*};div(*)[*]{*};li(*)[*]{*};ul(*)[*]{*}';
        CKEDITOR.dtd.$removeEmpty['i'] = false;
        </script>

        <!-- Custom Theme Scripts -->
        <script src="<?php echo base_url('adminudora-assets/js/custom.js'); ?>"></script>
        
            
        <!-- Script for this page -->
        <script type="text/javascript">

        var timerMap;
        var firstSet = false;
        var savedGpsData;
        var rent_inc_id = '55';

        $(function () {

            <?php if(config_db_item('price_by_purpose') == TRUE): ?>
            // Show price by purpose START //    
            $('form.form-estate ul.nav-tabs li a').each(function(){
                var lang_id = $(this).attr('href').substr(1);
                var sel_purpose = $('select[name=option4_'+lang_id+']').find('option:selected').text();
                hide_price_fields(sel_purpose, lang_id);

                $('select[name=option4_'+lang_id+']').change(function(){
                    var sel_purpose = $(this).find('option:selected').text();

                    hide_price_fields(sel_purpose, lang_id);
                })
            });

            function hide_price_fields(sel_purpose, lang_id)
            {
                if(sel_purpose=='<?php echo lang_check('Sale')?>')
                {
                    $('input[name=option36_'+lang_id+']').parent().parent().show();
                    $('input[name=option37_'+lang_id+']').parent().parent().hide();
                    $('input[name=option'+rent_inc_id+'_'+lang_id+']').parent().parent().hide();

                    $('input[name=option37_'+lang_id+']').val('');
                    $('input[name=option'+rent_inc_id+'_'+lang_id+']').val('');
                }
                else if(sel_purpose=='<?php echo lang_check('Rent')?>')
                {
                    $('input[name=option36_'+lang_id+']').parent().parent().hide();
                    $('input[name=option37_'+lang_id+']').parent().parent().show();
                    $('input[name=option'+rent_inc_id+'_'+lang_id+']').parent().parent().show();

                    $('input[name=option36_'+lang_id+']').val('');
                }
                else // Sale and Rent
                {
                    $('input[name=option36_'+lang_id+']').parent().parent().show();
                    $('input[name=option37_'+lang_id+']').parent().parent().show();
                    $('input[name=option'+rent_inc_id+'_'+lang_id+']').parent().parent().show();
                }
            }

            // Show price by purpose END //     
            <?php endif; ?>

            $('span.available-langs-sel').click(function(){
                $('#inputLanguage').val($(this).html());
            });

            $('.zoom-button').bind("click touchstart", function()
            {
                var myLinks = new Array();
                var current = $(this).attr('href');
                var curIndex = 0;

                $('.files-list .zoom-button').each(function (i) {
                    var img_href = $(this).attr('href');
                    myLinks[i] = img_href;
                    if(current == img_href)
                        curIndex = i;
                });

                options = {index: curIndex}

                blueimp.Gallery(myLinks, options);

                return false;
            });

            loadjQueryUpload();

            // If alredy selected
            if($('#inputGps').length && $('#inputGps').val() != '')
            {
                savedGpsData = $('#inputGps').val().split(", ");

                $("#mapsAddress").gmap3({
                    map:{
                      options:{
                        center: [parseFloat(savedGpsData[0]), parseFloat(savedGpsData[1])],
                        zoom: 14
                      }
                    },
                    marker:{
                    values:[
                      {latLng:[parseFloat(savedGpsData[0]), parseFloat(savedGpsData[1])]},
                    ],
                    options:{
                      draggable: true
                    },
                    events:{
                        dragend: function(marker){
                          $('#inputGps').val(marker.getPosition().lat()+', '+marker.getPosition().lng());
                        }
                  }}});

                firstSet = true;
            }
            else
            {
                $("#mapsAddress").gmap3({
                    map:{
                      options:{
                        center: [<?php echo isset($settings['gps'])?$settings['gps']:'45.81, 15.98'?>],
                        zoom: 12
                      },
                    },
                    marker:{
                        values:[
                          {latLng:[<?php echo isset($settings['gps'])?$settings['gps']:'45.81, 15.98'?>]},
                        ],
                        options:{
                          draggable: true
                        },
                        events:{
                            dragend: function(marker){
                              $('#inputGps').val(marker.getPosition().lat()+', '+marker.getPosition().lng());
                            }
                      }}
                  });

                  firstSet = true;
            }

            $('#inputAddress').keyup(function (e) {
                clearTimeout(timerMap);
                timerMap = setTimeout(function () {

                    $("#mapsAddress").gmap3({
                      getlatlng:{
                        address:  $('#inputAddress').val(),
                        callback: function(results){
                          if ( !results ){
                            //alert('Bad address!');
                            ShowStatus.show('<?php echo str_replace("'", "\'", lang_check('Address not found!'));?>');
                            return;
                          } 

                            if(firstSet){
                                $(this).gmap3({
                                    clear: {
                                      name:["marker"],
                                      last: true
                                    }
                                });
                            }

                          // Add marker
                          $(this).gmap3({
                            marker:{
                              latLng:results[0].geometry.location,
                               options: {
                                  id:'searchMarker',
                                  draggable: true
                              },
                              events: {
                                dragend: function(marker){
                                  $('#inputGps').val(marker.getPosition().lat()+', '+marker.getPosition().lng());
                                }
                              }
                            }
                          });

                          // Center map
                          $(this).gmap3('get').setCenter( results[0].geometry.location );

                          $('#inputGps').val(results[0].geometry.location.lat()+', '+results[0].geometry.location.lng());

                          firstSet = true;

                        }
                      }
                    });
                }, 2000);

            });

            $('#option_sortable').nestedSortable({
                handle: 'div',
                items: 'li',
                toleranceElement: '> div',
                maxLevels: 2,
                isAllowed: function(item, parent) {

                    // category can be only child of root element
                    if($(item).find('.label-danger').length == 1)
                    {
                        if($(parent).length > 0)return false;
                    }

                    return true; 
                },
                dropedCallback: sortableDroped
            });

            $('#page_sortable').nestedSortable({
                handle: 'div',
                items: 'li',
                toleranceElement: '> div',
                maxLevels: $('#page_sortable').attr('rel'),
                isAllowed: function(item, parent) {    
                    try
                    {
                        var parent_id = parent.attr('rel');

                        if (typeof parent_id !== 'undefined' && parent_id !== false) {
                            //console.log(parent_id+' '+parent.find('span.label-info').length);
                            if(parent_id > 0 && parent.find('span.label-info').length == 0)
                                return false;
                        }
                    }
                    catch(err)
                    {
                        //Handle errors here
                    }

                    return true; 
                },
                dropedCallback: sortablePageDroped
            });

            $('#showroom_sortable').nestedSortable({
                handle: 'div',
                items: 'li',
                toleranceElement: '> div',
                maxLevels: $('#showroom_sortable').attr('rel'),
                isAllowed: function(item, parent) {    
                    try
                    {
                        var parent_id = parent.attr('rel');

                        if (typeof parent_id !== 'undefined' && parent_id !== false) {
                            //console.log(parent_id+' '+parent.find('span.label-info').length);
                            if(parent_id > 0 && parent.find('span.label-info').length == 0)
                                return false;
                        }
                    }
                    catch(err)
                    {
                        //Handle errors here
                    }

                    return true; 
                },
                dropedCallback: sortableShowroomDroped
            });

            $('#expert_sortable').nestedSortable({
                handle: 'div',
                items: 'li',
                toleranceElement: '> div',
                maxLevels: $('#expert_sortable').attr('rel'),
                isAllowed: function(item, parent) {    
                    try
                    {
                        var parent_id = parent.attr('rel');

                        if (typeof parent_id !== 'undefined' && parent_id !== false) {
                            //console.log(parent_id+' '+parent.find('span.label-info').length);
                            if(parent_id > 0 && parent.find('span.label-info').length == 0)
                                return false;
                        }
                    }
                    catch(err)
                    {
                        //Handle errors here
                    }

                    return true; 
                },
                dropedCallback: sortableExpertDroped
            });

            $('.copy_to_next').keyup(function (e) {
                var element_to = $(this).parent().parent().next('div').find('input');

                if(element_to.val() == $(this).val().substr(0,$(this).val().length-1))
                    element_to.val($(this).val());
            });

            $('.tabbable li a').click(function () { 
                var tab_width = 0;
                var tab_width_real = 0;
                $('.tab-content').find('div.cleditorToolbar:first .cleditorGroup').each(function (i) {
                    tab_width += $(this).width();
                });

                tab_width_real = $('.tab-content').find('div.cleditorToolbar').width();
                var rows = parseInt(tab_width/tab_width_real+1)

                $('.tab-content').find('div.cleditorToolbar').height(rows*27);
            });

            $('.footable').footable();

        });

        function sortableShowroomDroped()
        {
            oSortable = null;
            if($('#showroom_sortable').length)
                oSortable = $('#showroom_sortable').nestedSortable('toArray');
            $.fn.startLoading();
            $.post('<?php echo site_url('admin/showroom/update_ajax'); ?>', 
            { sortable: oSortable }, 
            function(data){
                $.fn.endLoading();
            }, "json");
        }

        function sortableExpertDroped()
        {
            oSortable = null;
            if($('#expert_sortable').length)
                oSortable = $('#expert_sortable').nestedSortable('toArray');
            $.fn.startLoading();
            $.post('<?php echo site_url('admin/expert/update_ajax'); ?>', 
            { sortable: oSortable }, 
            function(data){
                $.fn.endLoading();
            }, "json");
        }

        function sortablePageDroped()
        {
            oSortable = null;
            if($('#page_sortable').length)
                oSortable = $('#page_sortable').nestedSortable('toArray');
            $.fn.startLoading();
            $.post('<?php echo site_url('admin/page/update_ajax'); ?>', 
            { sortable: oSortable }, 
            function(data){
                $.fn.endLoading();
            }, "json");
        }

        function sortableDroped()
        {
            oSortable = null;
            if($('#option_sortable').length)
                oSortable = $('#option_sortable').nestedSortable('toArray');
            $.fn.startLoading();

            $.post('<?php echo site_url('admin/estate/update_ajax'); ?>', 
            { sortable: oSortable }, 
            function(data){
                $.fn.endLoading();
            }, "json");
        }

        $.fn.startLoading = function(data){
            //$('#saveAll, #add-new-page, ol.sortable button, #saveRevision').button('loading');
        }

        $.fn.endLoading = function(data){
            //$('#saveAll, #add-new-page, ol.sortable button, #saveRevision').button('reset');       
            <?php if(config_item('app_type') == 'demo'):?>
                ShowStatus.show('<?php echo str_replace("'", "\'", lang('Data editing disabled in demo'));?>');
            <?php else:?>
                //ShowStatus.show('<?php echo lang('data_saved')?>');
            <?php endif;?>
        }

        function loadjQueryUpload()
        {
            $('form.fileupload').each(function () {
                $(this).fileupload({
                <?php if(config_item('app_type') != 'demo'):?>
                autoUpload: true,
                <?php endif;?>
                dataType: 'json',
                // The maximum width of the preview images:
                previewMaxWidth: 160,
                // The maximum height of the preview images:
                previewMaxHeight: 120,
                uploadTemplateId: null,
                downloadTemplateId: null,
                uploadTemplate: function (o) {
                    var rows = $();
                    //return rows;
                    $.each(o.files, function (index, file) {
                        /*
                        var row = $('<li class="img-rounded template-upload">' +
                            '<div class="preview"><span class="fade"></span></div>' +
                            '<div class="filename"><code>'+file.name+'</code></div>'+
                            '<div class="options-container">' +
                            '<span class="cancel"><button  class="btn btn-xs btn-warning"><i class="icon-ban-circle icon-white"></i></button></span></div>' +
                            (file.error ? '<div class="error"></div>' :
                                    '<div class="progress">' +
                                        '<div class="bar" style="width:0%;"></div></div></div>'
                            )+'</li>');
                        row.find('.name').text(file.name);
                        row.find('.size').text(o.formatFileSize(file.size));
                        */

                        var row = $('<div> </div>');
                        rows = rows.add(row);

                    });
                    return rows;
                },
                downloadTemplate: function (o) {
                    var rows = $();
                    $.each(o.files, function (index, file) {
                        var added=false;

                        if (file.error) {
                            ShowStatus.show(file.error);

                        } else {
                            added=true;

                            var row = $('<div class="col-md-55 img-rounded template-download fade"> \n\
                                            <div class="thumbnail">\n\
                                                <div class="image view view-first"> \n\
                                                    <div class="preview"><span class="fade"></span></div>\n\
                                                    <div class="mask">\n\
                                                        <p>'+file.short_name+'</p>\n\
                                                        <div class="tools tools-bottom options-container">\n\
                                                            <?php if($file->zoom_enabled):?>\n\
                                                            <a data-gallery="gallery" download="<?php echo $file->filename?>"><i class="fa fa-link"></i></a>\n\
                                                            <?php else:?>\n\
                                                            <a target="_blank" download="<?php echo $file->filename?>"><i class="fa fa-link"></i></a>\n\
                                                            <?php endif;?>'+
                                                                
                                                            (file.zoom_enabled?
                                                                '<a data-gallery="gallery" class="zoom-button" download="'+file.name+'"><i class="fa icon-zoom-in"></i></a>'
                                                                : '<a target="_blank" class="btn btn-xs btn-success" download="'+file.name+'"><i class="icon-search icon-white"></i></a>') 
                                                                        
                                                            +'<div class="delete"><button data-type="'+file.delete_type+'" data-url="'+file.delete_url+'"><i class="fa fa-times"></i></button></div>\n\
                                                        </div>\n\
                                                    </div>\n\
                                                </div>\n\
                                                <div class="caption">\n\
                                                    <p><?php echo lang_check('Remove');?>\n\
                                                    <input type="checkbox" value="1" name="delete">\n\
                                                    </p>\n\
                                                </div>\n\
                                            </div>'+
                                        (file.error ? '<div class="error"></div>' : '')
                                        +'</div>');
                        
/*
                            var row = $('<li class="img-rounded template-download fade">' +
                                '<div class="preview"><span class="fade"></span></div>' +
                                '<div class="filename"><code>'+file.short_name+'</code></div>'+
                                '<div class="options-container">' +
                                
                                (file.zoom_enabled?
                                    '<a data-gallery="gallery" class="zoom-button btn btn-xs btn-success" download="'+file.name+'"><i class="icon-search icon-white"></i></a>'
                                    : '<a target="_blank" class="btn btn-xs btn-success" download="'+file.name+'"><i class="icon-search icon-white"></i></a>') +
                                            
                                ' <span class="delete"><button class="btn btn-xs btn-danger" data-type="'+file.delete_type+'" data-url="'+file.delete_url+'"><i class="icon-trash icon-white"></i></button>' +
                                ' <input type="checkbox" value="1" name="delete"></span>' +
                                '</div>' +
                                (file.error ? '<div class="error"></div>' : '')+'</li>');*/


                            row.find('.name a').text(file.name);
                            if (file.thumbnail_url) {
                                row.find('.preview').html('<img class="img-rounded" alt="'+file.name+'" data-src="'+file.thumbnail_url+'" src="'+file.thumbnail_url+'">');  
                            }
                            row.find('a').prop('href', file.url);
                            row.find('a').prop('title', file.name);
                            row.find('.delete')
                                .attr('data-type', file.delete_type)
                                .attr('data-url', file.delete_url);
                        }

                        if(added)
                            rows = rows.add(row);
                    });

                    return rows;
                },
                destroyed: function (e, data) {
                    $.fn.endLoading();
                    <?php if(config_item('app_type') != 'demo'):?>
                    if(data.success)
                    {
                    }
                    else
                    {
                        ShowStatus.show('<?php echo lang_check('Unsuccessful, possible permission problems or file not exists'); ?>');
                    }
                    <?php endif;?>
                    return false;
                },
                <?php if(config_item('app_type') == 'demo'):?>
                added: function (e, data) {
                    $.fn.endLoading();
                    return false;
                },
                <?php endif;?>
                finished: function (e, data) {
                    
                    $('.files-list .template-download').addClass('in');
                    
                    $('.zoom-button').unbind('click touchstart');
                    $('.zoom-button').bind("click touchstart", function()
                    {
                        var myLinks = new Array();
                        var current = $(this).attr('href');
                        var curIndex = 0;

                        $('.files-list .zoom-button').each(function (i) {
                            var img_href = $(this).attr('href');
                            myLinks[i] = img_href;
                            if(current == img_href)
                                curIndex = i;
                        });

                        options = {index: curIndex}

                        blueimp.Gallery(myLinks, options);

                        return false;
                    });
                },
                dropZone: $(this)
            });
            });       

            $("ul.files,div.files").each(function (i) {
                $(this).sortable({
                    update: saveFilesOrder
                });
                $(this).disableSelection();
            });

        }

        function filesOrderToArray(container)
        {
            var data = {};

            container.find('li, div').each(function (i) {
                var filename = $(this).find('.options-container a:first').attr('download');
                data[i+1] = filename;
            });

            return data;
        }

        function saveFilesOrder( event, ui )
        {
            var filesOrder = filesOrderToArray($(this));
            var pageId = $(this).parent().parent().parent().attr('id').substring(11) || $(this).closests('.page-files-box').attr('id').substring(11);
            var modelName = $(this).parent().parent().parent().attr('rel') || $(this).closests('.page-files-box').attr('rel');

            $.fn.startLoading();
                    $.post('<?php echo site_url('files/order'); ?>/'+pageId+'/'+modelName, 
            { 'page_id': pageId, 'order': filesOrder }, 
            function(data){
                $.fn.endLoading();
                    }, "json");
        }

        </script>
        <?php if(config_item('onmouse_gallery_enabled') === TRUE): ?>    
        <style>
        .onmouse_gallery-title-files {
            padding: 0;
            margin: 0;
            list-style: none;
            height: 30px;
            overflow: hidden;
            width: 100%;
        }

        .onmouse_gallery-title-files li {
            color: red;
            float:left;
            margin: 3px 3px 3px 0;
            padding: 1px;
            display: block;
            float: left;
            width: 164px;
        }

        .onmouse_gallery-notice {
            color: red;
            font-size: 16px;
            margin-bottom: 5px;
        }
        </style>
        <?php endif;?>
        <script>
            $(document).ready(function(){
                if (!$('#blueimp-gallery').length)
                $('body').append('<div id="blueimp-gallery" class="blueimp-gallery">\n\
                                    <div class="slides"></div>\n\
                                    <h3 class="title"></h3>\n\
                                    <a class="prev">&lsaquo;</a>\n\
                                    <a class="next">&rsaquo;</a>\n\
                                    <a class="close">&times;</a>\n\
                                    <a class="play-pause"></a>\n\
                                    <ol class="indicator"></ol>\n\
                                    </div>')
        
                $('.myDatepicker').datetimepicker({
                    format: 'YYYY-MM-DD'
                });
        
                $('.myDatepicker_full').datetimepicker({
                    sideBySide: true,
                    format: 'YYYY-MM-DD HH:mm:ss'
                });
            })
        </script>
    </body>
</html>
